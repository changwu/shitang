# 每日早上打卡和午餐消费统计查询

## 查询功能
统计每天车辆和人员早上9点前打卡人员个数和午餐消费人数。

## SQL查询文件
- `daily_morning_checkins_and_lunch_complete.sql` - 完整版（推荐）
- `daily_morning_checkins_and_lunch.sql` - 简洁版

## 查询结果说明

### 字段说明
| 字段名 | 说明 | 示例值 |
|--------|------|--------|
| 日期 | 统计日期 | 2025-11-24 |
| 早上9点前车辆打卡人数 | 车辆早上9点前打卡人数 | 84 |
| 早上9点前人员打卡人数 | 人员早上9点前打卡人数 | 189 |
| 早上9点前总打卡人数 | 早上9点前总打卡人数 | 273 |
| 午餐消费人数 | 当天午餐消费人数 | 313 |
| 午餐消费率(%) | 午餐人数/早上打卡人数的百分比 | 114.7% |

### 数据洞察

从查询结果可以看出：

1. **工作日模式**：工作日（如11月24日）早上打卡人数较多（273人），午餐消费也相应较多（313人）

2. **周末模式**：周末（如11月23日）早上打卡人数很少（30人），午餐消费为0，符合休息规律

3. **午餐消费率**：工作日午餐消费率通常在100-120%之间，说明部分人员可能直接来午餐而没有早上打卡

4. **数据一致性**：系统记录了从2025年1月到11月的完整数据，共328天的统计记录

## 查询特点

- ✅ **时间精确筛选**：使用 `EXTRACT(HOUR FROM record_date) < 9` 精确筛选9点前数据
- ✅ **去重统计**：使用 `COUNT(DISTINCT name)` 避免同一人多次打卡重复计数
- ✅ **多表联合**：同时统计车辆记录、人员记录和食堂消费记录
- ✅ **性能优化**：利用现有索引快速查询
- ✅ **数据完整性**：包含COALESCE处理空值，确保数据完整性

## 使用建议

1. **定期运行**：可以设置定时任务每天运行此查询
2. **异常监控**：关注午餐消费率异常高或低的情况
3. **趋势分析**：可以按周、月汇总分析长期趋势
4. **可视化展示**：在Metabase中创建图表进行可视化分析